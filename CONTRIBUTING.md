# è´¡çŒ®æŒ‡å— ğŸ¤

æ„Ÿè°¢ä½ å¯¹ C++ é«˜æ€§èƒ½ç¼–ç¨‹å®Œå…¨æŒ‡å—é¡¹ç›®çš„å…´è¶£ï¼æœ¬æ–‡æ¡£å°†å¸®åŠ©ä½ äº†è§£å¦‚ä½•ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®ã€‚

## ğŸ“‹ ç›®å½•

- [è¡Œä¸ºå‡†åˆ™](#è¡Œä¸ºå‡†åˆ™)
- [å¦‚ä½•è´¡çŒ®](#å¦‚ä½•è´¡çŒ®)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [æäº¤è§„èŒƒ](#æäº¤è§„èŒƒ)
- [æµ‹è¯•è¦æ±‚](#æµ‹è¯•è¦æ±‚)
- [æ–‡æ¡£è§„èŒƒ](#æ–‡æ¡£è§„èŒƒ)

---

## è¡Œä¸ºå‡†åˆ™

æˆ‘ä»¬è‡´åŠ›äºè¥é€ ä¸€ä¸ªå¼€æ”¾ã€å‹å¥½ã€åŒ…å®¹çš„ç¯å¢ƒã€‚å‚ä¸æœ¬é¡¹ç›®å³è¡¨ç¤ºä½ åŒæ„éµå®ˆä»¥ä¸‹å‡†åˆ™ï¼š

- âœ… å°Šé‡ä¸åŒçš„è§‚ç‚¹å’Œç»éªŒ
- âœ… ä¼˜é›…åœ°æ¥å—å»ºè®¾æ€§æ‰¹è¯„
- âœ… å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰åˆ©çš„äº‹æƒ…
- âœ… å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒç†å¿ƒ
- âŒ ç¦æ­¢ä½¿ç”¨æ€§åŒ–çš„è¯­è¨€æˆ–å›¾åƒ
- âŒ ç¦æ­¢äººèº«æ”»å‡»æˆ–æ”¿æ²»æ”»å‡»
- âŒ ç¦æ­¢éªšæ‰°è¡Œä¸º

---

## å¦‚ä½•è´¡çŒ®

### æŠ¥å‘Š Bug

åœ¨æäº¤ Bug æŠ¥å‘Šå‰ï¼Œè¯·å…ˆï¼š

1. æœç´¢ç°æœ‰çš„ Issueï¼Œé¿å…é‡å¤
2. ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬é‡ç°é—®é¢˜
3. ç¡®å®šè¿™æ˜¯ä»£ç é—®é¢˜è€Œéä½¿ç”¨é—®é¢˜

**Bug æŠ¥å‘Šåº”åŒ…å«**:

```markdown
**ç¯å¢ƒä¿¡æ¯**
- æ“ä½œç³»ç»Ÿ: [e.g., Ubuntu 22.04]
- ç¼–è¯‘å™¨: [e.g., GCC 14.1]
- CPU: [e.g., Intel Core i7-12700K]

**é‡ç°æ­¥éª¤**
1. æ‰§è¡Œ '...'
2. è§‚å¯Ÿåˆ° '...'
3. é¢„æœŸç»“æœ '...'

**å®é™…ç»“æœ**
[æ¸…æ™°æè¿°å®é™…å‘ç”Ÿçš„æƒ…å†µ]

**é¢„æœŸç»“æœ**
[æ¸…æ™°æè¿°ä½ æœŸæœ›å‘ç”Ÿçš„æƒ…å†µ]

**ç›¸å…³æ—¥å¿—/æˆªå›¾**
[å¦‚æœé€‚ç”¨ï¼Œæ·»åŠ æ—¥å¿—æˆ–æˆªå›¾]
```

### å»ºè®®æ–°åŠŸèƒ½

**åŠŸèƒ½å»ºè®®åº”åŒ…å«**:

```markdown
**åŠŸèƒ½æè¿°**
æ¸…æ™°ç®€æ´åœ°æè¿°ä½ æƒ³è¦çš„åŠŸèƒ½

**åŠ¨æœº**
ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**æ›¿ä»£æ–¹æ¡ˆ**
ä½ è€ƒè™‘è¿‡å“ªäº›å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Ÿ

**é¢å¤–ä¸Šä¸‹æ–‡**
ä»»ä½•å…¶ä»–æœ‰åŠ©äºç†è§£çš„ä¿¡æ¯
```

### æäº¤ä»£ç 

1. **Fork ä»“åº“**
   ```bash
   [https://github.com/jianbangzhang/cpp_high_performance.git](https://github.com/jianbangzhang/cpp_high_performance.git)
   cd cpp-performance-guide
   ```

2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯**
   ```bash
   git checkout -b feature/your-feature-name
   # æˆ–
   git checkout -b fix/your-bug-fix
   ```

3. **è¿›è¡Œä¿®æ”¹**
   - éµå¾ªä»£ç è§„èŒƒ
   - æ·»åŠ æµ‹è¯•
   - æ›´æ–°æ–‡æ¡£

4. **æäº¤æ›´æ”¹**
   ```bash
   git add .
   git commit -m "feat: add new optimization technique"
   ```

5. **æ¨é€åˆ° GitHub**
   ```bash
   git push origin feature/your-feature-name
   ```

6. **åˆ›å»º Pull Request**
   - æä¾›æ¸…æ™°çš„ PR æè¿°
   - é“¾æ¥ç›¸å…³çš„ Issue
   - ç­‰å¾… Review

---

## ä»£ç è§„èŒƒ

### C++ ä»£ç é£æ ¼

æˆ‘ä»¬éµå¾ªä¿®æ”¹åçš„ [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html)ï¼š

#### å‘½åè§„èŒƒ

```cpp
// ç±»åï¼šPascalCase
class DataProcessor { };

// å‡½æ•°åï¼šsnake_case
void process_data() { }

// å˜é‡åï¼šsnake_case
int user_count = 0;

// å¸¸é‡ï¼škPascalCase
constexpr int kMaxBufferSize = 1024;

// ç§æœ‰æˆå‘˜å˜é‡ï¼štrailing underscore
class Widget {
private:
    int width_;
    int height_;
};

// å®ï¼šUPPER_CASE
#define MAX_ITERATIONS 100
```

#### æ ¼å¼åŒ–

```cpp
// ä½¿ç”¨ clang-format
// .clang-format æ–‡ä»¶:
BasedOnStyle: Google
IndentWidth: 4
ColumnLimit: 100
```

è¿è¡Œæ ¼å¼åŒ–ï¼š
```bash
clang-format -i your_file.cpp
```

#### æ³¨é‡Šè§„èŒƒ

```cpp
// æ–‡ä»¶å¤´æ³¨é‡Š
/**
 * @file custom_allocator.cpp
 * @brief é«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨å®ç°
 * @author Your Name
 * @date 2025-01-01
 */

// å‡½æ•°æ³¨é‡Š
/**
 * @brief åˆ†é…æŒ‡å®šå¤§å°çš„å†…å­˜å—
 * @param size éœ€è¦åˆ†é…çš„å­—èŠ‚æ•°
 * @param alignment å¯¹é½è¦æ±‚ï¼ˆå­—èŠ‚ï¼‰
 * @return æŒ‡å‘åˆ†é…å†…å­˜çš„æŒ‡é’ˆï¼Œå¤±è´¥è¿”å› nullptr
 * @throws std::bad_alloc å†…å­˜ä¸è¶³æ—¶æŠ›å‡º
 */
void* allocate(size_t size, size_t alignment = alignof(std::max_align_t));

// å¤æ‚é€»è¾‘æ³¨é‡Š
// ä½¿ç”¨ Three-Pass ç®—æ³•è¿›è¡ŒçŸ©é˜µåˆ†è§£:
// Pass 1: è®¡ç®—ä¸»å…ƒ
// Pass 2: æ›´æ–°å­çŸ©é˜µ
// Pass 3: å›ä»£æ±‚è§£
```

#### æ€§èƒ½è¦æ±‚

æ‰€æœ‰æ–°å¢ä»£ç å¿…é¡»ï¼š

1. **åŸºå‡†æµ‹è¯•**: æä¾›æ€§èƒ½æµ‹è¯•ä»£ç 
   ```cpp
   BENCHMARK(NewFeature) {
       // æµ‹è¯•ä»£ç 
   }
   ```

2. **æ€§èƒ½å¯¹æ¯”**: ä¸ç°æœ‰æ–¹æ¡ˆå¯¹æ¯”
   ```markdown
   | å®ç° | æ—¶é—´ (ms) | åŠ é€Ÿæ¯” |
   |------|----------|--------|
   | åŸå®ç° | 100 | 1.0Ã— |
   | æ–°å®ç° | 25 | 4.0Ã— |
   ```

3. **å†…å­˜åˆ†æ**: æŠ¥å‘Šå†…å­˜ä½¿ç”¨
   ```bash
   valgrind --tool=massif ./benchmark
   ```

---

## æäº¤è§„èŒƒ

æˆ‘ä»¬ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

### æäº¤ç±»å‹

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: é‡æ„ï¼ˆæ—¢éæ–°å¢åŠŸèƒ½ï¼Œä¹Ÿéä¿®å¤ Bugï¼‰
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

### æäº¤æ¶ˆæ¯æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç¤ºä¾‹**:

```
feat(simd): add AVX-512 support for vector operations

Implement AVX-512 intrinsics for vector addition, multiplication,
and dot product operations. Benchmarks show 2x improvement over
AVX2 on Intel Xeon processors.

Closes #123
```

```
perf(allocator): optimize pool allocator lock contention

Replace mutex with lock-free stack for free list management.
Reduces allocation time by 40% under high contention.

Benchmark results:
- Before: 850 ns/op
- After: 510 ns/op (1.67x faster)

Fixes #456
```

---

## æµ‹è¯•è¦æ±‚

### å•å…ƒæµ‹è¯•

æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»åŒ…å«å•å…ƒæµ‹è¯•ï¼š

```cpp
// test_allocator.cpp
#include <gtest/gtest.h>
#include "pool_allocator.hpp"

TEST(PoolAllocator, BasicAllocation) {
    PoolAllocator<int> alloc;
    int* ptr = alloc.allocate(1);
    
    ASSERT_NE(ptr, nullptr);
    *ptr = 42;
    EXPECT_EQ(*ptr, 42);
    
    alloc.deallocate(ptr, 1);
}

TEST(PoolAllocator, Performance) {
    constexpr int N = 10000;
    
    auto start = std::chrono::high_resolution_clock::now();
    
    PoolAllocator<int> alloc;
    for (int i = 0; i < N; ++i) {
        int* ptr = alloc.allocate(1);
        alloc.deallocate(ptr, 1);
    }
    
    auto end = std::chrono::high_resolution_clock::now();
    auto duration = std::chrono::duration<double, std::nano>(end - start).count();
    
    // æ€§èƒ½ç›®æ ‡: < 100 ns per operation
    EXPECT_LT(duration / N, 100.0);
}
```

### åŸºå‡†æµ‹è¯•

ä½¿ç”¨ Google Benchmarkï¼š

```cpp
// benchmark_allocator.cpp
#include <benchmark/benchmark.h>
#include "pool_allocator.hpp"

static void BM_PoolAllocator(benchmark::State& state) {
    PoolAllocator<int> alloc;
    
    for (auto _ : state) {
        int* ptr = alloc.allocate(1);
        benchmark::DoNotOptimize(ptr);
        alloc.deallocate(ptr, 1);
    }
}
BENCHMARK(BM_PoolAllocator);

static void BM_StdAllocator(benchmark::State& state) {
    std::allocator<int> alloc;
    
    for (auto _ : state) {
        int* ptr = alloc.allocate(1);
        benchmark::DoNotOptimize(ptr);
        alloc.deallocate(ptr, 1);
    }
}
BENCHMARK(BM_StdAllocator);

BENCHMARK_MAIN();
```

### è¿è¡Œæµ‹è¯•

```bash
# æ„å»ºæµ‹è¯•
mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release -DENABLE_TESTING=ON
make

# è¿è¡Œå•å…ƒæµ‹è¯•
ctest --output-on-failure

# è¿è¡ŒåŸºå‡†æµ‹è¯•
./benchmark_allocator --benchmark_repetitions=10
```

---

## æ–‡æ¡£è§„èŒƒ

### README æ–‡ä»¶

æ¯ä¸ªæ–°ç« èŠ‚éƒ½åº”åŒ…å« `README.md`ï¼š

```markdown
# Chapter X: ä¸»é¢˜åç§°

> **ç›®æ ‡**: ä¸€å¥è¯æè¿°å­¦ä¹ ç›®æ ‡

## å…³é”®å†…å®¹

- æ¦‚å¿µ 1
- æ¦‚å¿µ 2
- æ¦‚å¿µ 3

## ç¤ºä¾‹ä»£ç 

[é“¾æ¥åˆ°ç¤ºä¾‹]

## æ€§èƒ½æå‡

| ä¼˜åŒ–å‰ | ä¼˜åŒ–å | åŠ é€Ÿæ¯” |
|--------|--------|--------|
| 100 ms | 25 ms | 4.0Ã— |

## å‚è€ƒèµ„æº

- [æ–‡ç«  1]
- [è§†é¢‘ 2]
```

### ä»£ç æ³¨é‡Š

- æ‰€æœ‰å…¬å¼€ API å¿…é¡»æœ‰ Doxygen æ³¨é‡Š
- å¤æ‚ç®—æ³•éœ€è¦è¯´æ˜åŸç†
- æ€§èƒ½å…³é”®ä»£ç éœ€è¦è§£é‡Šä¼˜åŒ–æ€è·¯

### æ•™ç¨‹æ–‡æ¡£

- ä½¿ç”¨æ¸…æ™°çš„æ ‡é¢˜å±‚æ¬¡
- æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹
- åŒ…å«æ€§èƒ½å¯¹æ¯”æ•°æ®
- æ·»åŠ "æœ€ä½³å®è·µ"éƒ¨åˆ†

---

## å®¡æŸ¥æµç¨‹

### Pull Request Checklist

æäº¤ PR å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] ä»£ç éµå¾ªé¡¹ç›®é£æ ¼æŒ‡å—
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] æäº¤æ¶ˆæ¯ç¬¦åˆè§„èŒƒ
- [ ] æ²¡æœ‰å¼•å…¥ç¼–è¯‘è­¦å‘Š
- [ ] æ€§èƒ½æ²¡æœ‰é€€åŒ–

### Review è¿‡ç¨‹

1. **è‡ªåŠ¨æ£€æŸ¥**: CI è¿è¡Œæµ‹è¯•å’Œé™æ€åˆ†æ
2. **ä»£ç å®¡æŸ¥**: è‡³å°‘ä¸€ä½ç»´æŠ¤è€…å®¡æŸ¥
3. **æ€§èƒ½éªŒè¯**: éªŒè¯æ€§èƒ½æå‡
4. **æ–‡æ¡£å®¡æŸ¥**: æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§
5. **åˆå¹¶**: æ‰€æœ‰æ£€æŸ¥é€šè¿‡ååˆå¹¶

---

## è”ç³»æ–¹å¼

- **Issue**: æŠ€æœ¯é—®é¢˜å’Œ Bug æŠ¥å‘Š
- **Discussion**: åŠŸèƒ½è®¨è®ºå’Œæƒ³æ³•åˆ†äº«
- **Email**: whdx072018@foxmail.com

---

## è®¸å¯è¯

è´¡çŒ®åˆ°æœ¬é¡¹ç›®çš„ä»£ç å°†ä½¿ç”¨ [MIT License](LICENSE) å‘å¸ƒã€‚

---

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

[![Contributors](https://contrib.rocks/image?repo=yourusername/cpp-performance-guide)](https://github.com/yourusername/cpp-performance-guide/graphs/contributors)

---

**ç¥ä½ ç¼–ç æ„‰å¿«ï¼ğŸš€**
